# mega.itmo - описание работы по кейсу "Сборка генома бактерии"
_Авторы: Станислав Сергеенков, Евгений Федоров, Иван Углов_

## Общая концепция решения
Мы разбили решение на несколько относительно простых подэтапов:

0. Осознание сущности бытия
_предположим, что некий патогенный организм - это биктерия или вирус (как наиболее вероятные варианты): таком случае их геном будет сравнительно небольшим и при этом достаточно простым для анализа._
1. Сборка
   - для _de novo_ сборки генома выбрали SPAdes как наиболее эффективный программный алгоритм, позволяющий собирать небольшие геномы.
2. Идентификация организма
   - С применением Core nucleotide database (core nt). Для досутпа к базе данных, в силу ограничений веб-версии BLAST NCBI в 1 мегабаз, использовался онлайн сервис BV-BRC.
   - Повторное выравнивание на референсный геном выполнялось посредством NCBI BLAST для уточнения процента идентичности выровненной последовательности референсному геному.
3. Поиск факторов патогенности
   - Для поиска факторов патогенности выбрана VFDB в качестве источника информации о факторах патогенности

##Первая попытка
**Сборка**
Выполнялась с применением программного алгоритма SPAdes, скрипт для запуска:
```
spades.py --isolate -1 pe_1.fastq -2 pe_2.fastq -o spades_output -t 16 -m 32
```
[Выходные данные](first_attempt_at_genome_assembly)

**Выравнивание и поиск совпадений**


**Осознание своих ошибок - путь к истине**
В результате анализа получены результаты, которые не соответствовали исходному предположению, что в образце присутствует только один микроорганизм. ПОдобные результаты можно получить в различных обстоятельствах:
* Наличие мобильных генетических элементов или горизонтально перенесенных генов _(не давалобы 100% совпадения по WGS)_
* Контаминация на этапе сборки (в файле присутствуют некорректные риды, относящиеся к другим образцам) _(возможная причина)_
* Контаминация на этапе секвенирования, выделения или очистки ДНК _(вероятная причина)_
* Высококонсервативные гены _(не давало бы 100% совпадения по WGS)_
* Слишком короткая последовательность _(не применимо - мы работаем с WGS)_

##Вторая попытка
**Сборка**
Предварительно выполнено триммирование для удаления низкокачественных участков и технических артефактов из прочтений (reads) с целью повышения точности и надежности всех последующих анализов посредством программного пакета [fastp](https://github.com/OpenGene/fastp) посредством следующего скрипта:
```
./fastp -i pe_1.fastq -I pe_2.fastq -o trimmed_R1.fastq -O trimmed_R2.fastq --detect_adapter_for_pe -q 10 -u 30 -l 50 --html fastp_report.html --json fastp_report.json
```
[Выходные данные выполнения триммирования](https://web-projects.kvnel.ru/ivan/trimmed/fastp_report.html)

[Триммированное прямое чтение](https://web-projects.kvnel.ru/ivan/trimmed/trimmed_R1.fastq)

[Триммированное обратное чтение](https://web-projects.kvnel.ru/ivan/trimmed/trimmed_R2.fastq)

Сборка производилась аналогично первой попытке: посредством SPAdes:
```
spades.py --isolate -1 pe_1.fastq -2 pe_2.fastq -o spades_output -t 16 -m 32
```
[Выходные данные сборки](second_attempt_at_genome_assembly)

**Выравнивание и поиск совпадений**
Хотя мы и уменьшили количество ложных совпадений, полученные результаты всё равно указывают на совпадение как с _Clostridium botulinum B str. Eklund 17B_, complete genome, так и с _Salmonella enterica subsp. enterica serovar Typhi str. CT18_, complete genome (и другими штаммами и сборками).
[Выходные данные выравнивания БД](ncbi_blast_second_alignment
/second_alignment_of_the_assembly_TRIMMED.csv)

Для пожтверждения предположения о принадлежности собранного генома к одному конкретному микроорганизму выполнено выравнивание на референсный геном. Процент идентичности с _Clostridium botulinum b str. eklund 17b_ более >98%.
[Выходные данные выравнивания на референс](ncbi_blast_second_alignment/RST6ZZB2114-Alignment-HitTable.csv)

**Поиск факторов патогенности**
Выполнялся с применением [VFDB в качестве источника информации о факторах патогенности](https://www.mgc.ac.cn/cgi-bin/VFs/genus.cgi?Genus=Clostridium).
Собранный и идентифицированный геном структурно и функционально аннотировался с помощью NCBI PGAP:
```
sudo ./pgap.py -r -o trimmed_sbork -g scaffolds.fasta -s 'Clostridium botulinum' --ignore-all-errors
```
[Выходные данные аннотирования](annotation)

Полученный список размеченных генов сравнен с ранее упомянутой VFDB. Обнаружено 20 факторов патогенности, [все они перечислены в таблице](search_for_pathogenicity_factors/pathogenic_gene.tsv).
